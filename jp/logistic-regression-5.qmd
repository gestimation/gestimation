---
title: "Simpson's paradox"
format:
  html:
    toc: true
---

```{=html}
<style>
header#title-block-header.quarto-title-block {
  display: none !important;
}

body {
  margin: 0;
  background: #ffffff;
  color: #2b1f1a;
  font-family: "Inter", "Helvetica Neue", Arial, sans-serif;
  font-size: 18px;
  line-height: 1.55;
}

h1, h2, h3 {
  font-family: "Georgia", "Times New Roman", serif;
  color: #3a2a22;
  font-weight: 600;
}

h3 {
  margin-top: 2.4rem;
}

a {
  color: #8b4a24;
  text-decoration: none;
}
a:hover {
  color: #6f3718;
  text-decoration: underline;
}

.navbar {
  background: #ffffff !important;
  border-bottom: 1px solid #e6e0da;
  margin-bottom: 0 !important;
}
.navbar .navbar-brand,
.navbar .navbar-nav > li > a {
  color: #3a2a22 !important;
  border-bottom: 2px solid transparent;
  padding-bottom: 2px;
}
.navbar .navbar-nav > li > a:hover {
  border-bottom-color: #8b4a24;
}

.hero-text {
  padding: 1.5rem 0;
  color: #3a2a22;
}

.project-card {
  border: 1px solid #e6e0da;
  padding: 1.3rem 1.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  background: #ffffff;
  border-radius: 6px;
  margin-bottom: 1.5rem;
}

.about-section {
  border: 1px solid #e6e0da;
  padding: 1.5rem;
  border-radius: 0;
  background: #ffffff;
  margin-top: 2.5rem;
}

.about-section::after {
  content: "";
  display: block;
  clear: both;
}

.author-photo {
  float: left;
  margin-right: 1rem;
  border-radius: 50%;
}

.btn-link {
  display: inline-block;
  border: 1px solid #8b4a24;
  color: #8b4a24;
  padding: 0.4rem 0.9rem;
  font-size: 0.9rem;
  border-radius: 3px;
}
.btn-link:hover {
  background: #8b4a24;
  color: #ffffff;
}

.content-narrow {
  max-width: 1000px;
  margin: 0 auto;
  padding: 1.8rem 1.2rem 2.5rem;
}

.hero-header {
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
}

.hero-header-img {
  width: 100vw;
  height: min(400px, 45vh);
  object-fit: cover;
  object-position: 50% 40%;
  display: block;
}

.dialogue p {
  line-height: 1.7;
}
.dialogue .voice-father p {
  color: #7a3e1a !important;
}
.dialogue .voice-daughter p {
  color: #234f7c !important;
}
.dialogue .voice-daughter,
.dialogue .voice-father {
  margin-bottom: 0.4rem;
}

.text-right {
  text-align: right;
}
.serif-block p {
  font-family: "Georgia", "Times New Roman", serif;
  font-size: 0.9em;  line-height: 1.6;
}
</style>
```

::: hero-header
![](../image/father-daughter.png){.hero-header-img}
:::

# Adjusting for bias V − Simpson's paradox

::: {.serif-block .text-right}
Keywords: binary outcome, confounding/collapsibility, effect measure, generalized linear model
:::

------------------------------------------------------------------------

### ロジスティック回帰で「調整する」ってどういうこと？

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「お父さん、ロジスティック回帰でわからないことがあるんだけど。以前、観察研究では**交絡因子**を調整しないといけない、とかいってたよね」
::: 

::: voice-father
お父さん「ああ、そんな話もあったね」
::: 

::: voice-daughter
私「でもさ、調整しないオッズ比も計算できるでしょ。どっちが正しいのかってどうやればわかるの？統計学の本を読んでも、書いてなくて」
::: 

::: voice-father
お父さん「それは統計学だけではわからない問題なんだ。データがどんな確率分布に従っているか、誰も知らないからね。因果推論や医学知識を使って判断すべき問題になる」
::: 

::: voice-daughter
私「なにそれ？統計学の話じゃないの？ロジスティック回帰について聞いてるんだけど」
::: 

::: voice-father
お父さん「そう思うよねえ。じゃあちょっと時間をかけて説明させてよ。」
:::

::: voice-daughter
私「いいけど」
::: 

::: voice-father
お父さん「疫学の分野での話なんだけどね。40年前に、コーヒーが膵がんを増やすんじゃないか、っていう論文がでたことがある」
::: 

::: voice-daughter
私「いかにもありそうな話だね」
::: 

::: voice-father
お父さん「そうでしょ。でも、疫学研究では、コーヒーを飲んでいる人のような曝露集団と、うまく比較できるようなコントロールを選ぶことは、ほとんどの場合難しい。だから、疫学の教科書では、コントロールと比較するときには、第3の因子が隠れていないかどうかに注意しなければいけないと書いてある」
::: 

::: voice-daughter
私「ふんふん」
::: 

::: voice-father
お父さん「それでは問題です。コーヒーと膵がんの論文で、実際に問題になった第3の因子はなんでしょう？」
::: 

::: voice-daughter
私「え？えーっと」
::: 

![](logistic-regression-1.png)

::: voice-father
お父さん「答えはこれ」
::: 
::::::::::::::::::::::::::::::::: 

::: {.callout-note appearance="simple" collapse="true" title="お父さんの答えは？"}
それは喫煙です。当時は今より喫煙率が高くて、ほとんどの方がコーヒーと一緒にたばこを吸っていたそうです。

![](logistic-regression-3.png)
:::

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「へえ、そんな話があったんだ」
::: 

::: voice-father
お父さん「じゃあさ、こういう第3の因子を無視して解析してしまうとどうなる？」
::: 

::: voice-daughter
私「それくらいわかるよ。バイアスが生じるんでしょ」
::: 

::: voice-father
お父さん「そういうこと。前にいったように、こういう因子は、疫学では**交絡因子（confounder）**と呼ばれている。交絡因子はロジスティック回帰で調整しないといけない。調整したときとしないときで、まったく違った結果が得られるっていう数値例を示そう」
:::
:::::::::::::::::::::::::::::::::


::: {.callout-note appearance="simple" title="Simpsonのパラドックス"}

コーヒーと膵がんの数値例を用いて、統計学でいう調整とはどういう操作のことなのかみてみましょう。ここでは層別解析を用いて説明しますが、ロジスティック回帰でオッズ比を求めたときも、同じ計算結果になります（交互作用をうまく入れる必要がありますが）。

表1は、コーヒーと膵がんを想定した仮想データです。コーヒー摂取群とコーヒー非摂取群で、それぞれ膵がん発生ありとなしが調べられています。膵がんを発生したのはそれぞれの群で15人と12人、膵がんがなかったのは365人と868人です。オッズ比を計算してみましょう。コーヒー摂取群では膵がんリスクは3.9%で、コーヒーを摂取しない群の1.4%に比べて、オッズ比は3倍です。これは、コーヒーを摂取すると、膵がんリスクが高くなることを意味しています。

表2には、交絡因子（喫煙）によって対象者を層別した結果が示されています。ここから膵がんのオッズ比を求めるとどうなるでしょうか。コーヒー摂取でも非摂取でもリスクは同じですよね。つまりオッズ比は1倍です。

このように、調整前後で、関連の程度が変わる現象を、Simpsonのパラドックスといいます（Simpson 1951）。

表1. 層別前の膵がんリスクとオッズ比

|              | コーヒー摂取 | コーヒー非摂取 | オッズ比 |
|--------------|--------------|----------------|----------|
| 合計         |              |                |          |
| 　膵がんあり | 15           | 12             |          |
| 　膵がんなし | 365          | 868            |          |
| 　リスク     | 3.9%         | 1.4%           | 3倍      |

表2. 層別後の膵がんリスクとオッズ比

|              | コーヒー摂取 | コーヒー非摂取 | オッズ比 |
|--------------|--------------|----------------|----------|
| 喫煙         |              |                |          |
| 　膵がんあり | 14           | 4              |          |
| 　膵がんなし | 266          | 76             |          |
| 　リスク     | 5.0%         | 5.0%           | 1倍      |
| 非喫煙       |              |                |          |
| 　膵がんあり | 1            | 8              |          |
| 　膵がんなし | 99           | 792            |          |
| 　リスク     | 1.0%         | 1.0%           | 1倍      |

:::


::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「へー。単純な解析ではリスク因子なのに、層別しただけで関連が消えた。こんなことあるんだ」
::: 

::: voice-father
お父さん「そう、交絡因子を無視して、間違った研究結果を報告してしまうとまずいでしょ。もうひとつ注目してほしいのが、喫煙とコーヒーの関連。喫煙状況ごとにコーヒー摂取割合を計算してみてよ」
::: 

::: voice-daughter
私「コーヒー摂取割合ね。層別前は30%。喫煙集団では78%、非喫煙集団では11%だよ」
::: 

::: voice-father
お父さん「うん、喫煙群と非喫煙群でコーヒー摂取割合に大きな差があるでしょ。この現象が起きた理由は、コーヒー摂取と喫煙に強い関連があったため、ということ。もし仮に、 コーヒー摂取・非摂取という介入をランダムに割付けるランダム化介入試験を行ったらどうなると思う？」
::: 

::: voice-daughter
私「両群で喫煙割合は、ほぼ同じになるはず」
::: 

::: voice-father
お父さん「うん。そうすると、ランダム化介入試験で得られるオッズ比は、喫煙・非喫煙別の結果を平均することになるから、全体でも1倍に近い結果になると予想される。つまり、層別する前のオッズ比3倍という結果は、コーヒーではなく喫煙が真の原因となって生じた見かけの関連なので、層別した後のオッズ比が正しい。だから、ロジスティック回帰で調整オッズ比を求めるべきなんだ」
::: 
::::::::::::::::::::::::::::::::: 

::: {.callout-note title="glm()を用いた膵がんデータの解析"}

交絡調整のための統計手法として、層別解析以外に一般化線型モデルもよく用いられます。オッズ比のモデルであるロジスティック回帰は、`link="logit"`を用いた`glm()`に対応していましたね。以下のコードでは調整前のオッズ比は`smoke`を入れないモデルで、調整後のオッズ比は`smoke`を入れたモデルで推定しています。

```{r warning=FALSE}
dat <- data.frame(
  cancer = c(1, 0, 1, 0,   1, 0, 1, 0),
  coffee = c(1, 1, 0, 0,   1, 1, 0, 0),
  smoke  = c(1, 1, 1, 1,   0, 0, 0, 0),
  n      = c(14, 266, 4, 76,  1, 99, 8, 792)
)
fit_logit1 <- glm(
  cancer ~ coffee,
  family  = binomial(link = "logit"),
  weights = n,
  data    = dat
)
odds_ratio1 <- exp(coef(fit_logit1)[["coffee"]])
print(odds_ratio1)

fit_logit2 <- glm(
  cancer ~ coffee+smoke,
  family  = binomial(link = "logit"),
  weights = n,
  data    = dat
)
odds_ratio2 <- exp(coef(fit_logit2)[["coffee"]])
print(odds_ratio2)
```
:::


::::::::::::::::::::::::::::::::: dialogue
::: voice-father
お父さん「Simpsonのパラドックスが起きる条件を知りたい？」
::: 

::: voice-daughter
私「そりゃあね。解析方法によってオッズ比が1になるのは不思議だもの。あれ？ちょっと前こうやって雑談してたとき、オッズ比は層別すると数値が安定しないっていってたっけ？」
::: 

::: voice-father
お父さん「うん、オッズ比は併合可能ではない、non-collapsibleな指標だね。でも、Simpsonのパラドックスの条件は、オッズ比固有のものじゃない。ポイントは3つの変数の相関関係なんだ。第3の因子と曝露に相関があり、さらに第3の因子とアウトカムにも相関があるとき、Simpsonのパラドックスが起きる」
::: 

::: voice-daughter
私「なるほどね、喫煙はコーヒー摂取と関連する。さらに喫煙は膵がんリスクも上げる。そうするとオッズ比の値が変わる。ああ、もともとバイアスが入っちゃってたんだから、調整して値が変わるのは当たり前か」
::: 
:::::::::::::::::::::::::::::::::

### This concludes the Adjusting for Bias series. If you’d like to keep reading over your next cup of coffee, the following episode are waiting:

- [Truth: What Is It That You Want to Know?](truth.qmd)