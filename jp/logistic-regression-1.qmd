---
title: "Understanding Collapsibility of Effect Measures: Marginal vs Stratified"
description: "いわゆる調整解析とSimpsonのパラドックスの関係は？がん臨床試験で用いられる層別Cox回帰にもつながるエピソード。"
tags:
  - Bias
  - Confounding & collapsibility
  - Effect measure
  - R simulation
format:
  html:
    toc: true
---

::: {.hero-header}
![](../image/father-daughter.png){.hero-header-img}
:::

# Adjusting for Bias I − Understanding Collapsibility of Effect Measures: Marginal vs Stratified

::: {.serif-block .text-right}
Keywords: clinical trial, confounding & collapsibility, effect measure, R simulation
:::

------------------------------------------------------------------------

### 効果の指標

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「お父さん、なにか甘いものない？お腹すいちゃって」
:::

::: voice-father
お父さん「大福だったら買い置きがあるよ。コーヒーとお茶、どっちにする？」
:::

::: voice-daughter
私「コーヒー。ミルクも入れて。お茶もいいけど、統計の話を聞きたいときはコーヒーの気分なんだ。このあいだも、疫学で使う統計の話をしてくれたでしょ。でも、医学部で講義を受けたのが昔すぎてさ。疫学ってなにか忘れちゃったな」
:::

::: voice-father
お父さん「疫学か。疫学は、集団における病気について調べる分野だよね。病気の原因を調べたり、予防方法や公衆衛生対策を立てたりする。がん、循環器、感染症など扱う病気によってだいぶ違うよね。まあ、疫学の基本はなにかっていったら、コホート研究とリスクかな」
:::

::: voice-daughter
私「そうだったね、この前のワクチン有効率のやつは、リスクもワクチン有効率もパーセンテージ表記だからまぎらわしいって話だった。効果の指標（effect measure）もいろいろあったな。リスク比、オッズ比、ハザード比だっけ？」
:::
::::::::::::::::::::::::::::::::: 

### リスク比とオッズ比、どっちを使う？

::::::::::::::::::::::::::::::::: dialogue
::: voice-father
お父さん「じゃあ、リスク比とオッズ比の話をしようか。コーヒー飲みながら気楽に聞いてね。統計学が気にするのは、**それぞれの指標の意味・解釈**の違いもあるけど、それ以上に**数学的な性質**を考えているんだよね。オッズ比は数学的にいい面と悪い面がある。いいところは、”リスクの数値”と”1からリスクを引いた数値”が対称に出てくるような数式をしていること。生存確率と死亡確率をひっくり返しても同じっていったらいいかな」
:::

::: voice-daughter
私「ふーんそうなんだ」
:::

::: voice-father
お父さん「後は、ケース・コントロール研究のような、コホートの一部の情報しかない状況でも計算できるし、ロジスティック回帰のようなモデリングするとき利用しやすいのがいいところかな。悪い面はね、層別解析をしたとき、ちょっと不自然な計算結果になる」
:::

::: voice-daughter
私「ケース・コントロール研究って、データベースとかを使って後ろ向きに調査するやつね。これも疫学。そうねえ、不自然な数字になるのは困るんじゃない？層別なんてしたこと私はないけど」
:::

::: voice-father
お父さん「そうだね、次の2つの表は層別する前とする後の結果なんだけど、比べてみてよ」
:::
::::::::::::::::::::::::::::::::: 

::: {.callout-note appearance="simple" title="層別した指標の併合可能性"}
表1と表2は、がん患者100人のランダム化臨床試験を想定して作った数値例です。表1では100人全体における死亡リスクを、表2はステージIIIの50人とステージIVの50人に層別した死亡リスクを示しています。

まず、抗がん剤投与群の死亡リスクをみてください。ステージIIIでは死亡リスクは20%と低く、ステージIVでは40%と高いことがわかります。そして全体の死亡リスクは、ステージIIIとステージIVの平均（30%）です。このように、リスクには、層別する前の値が、層別した後の平均になるという性質があります。

これを踏まえて、リスク比、リスク差、オッズ比の性質を考えてみましょう。表1と表2を比べると、リスク比はすべて0.50倍です。このように、層別する前後でリスク比が変化しないことは、治療効果を測るために好ましい性質です。なぜなら、ステージIIIでリスクが半分になり、ステージIVでも半分になるなら、2つの層を合計してもリスクが半分になってほしいからです。リスク差は、2つのリスクの差をとったものです。したがって、リスクと同じように層別する前の値が、層別した後の平均になります。層ごとのリスク差が等しければ（この数値例ではそうなっていませんが）、層別前のリスク差も、層別後のリスク差と同じ値になるはずです。リスク差とリスク比の持つこの性質を、**併合可能性（collapsibility）**と呼んでいます。

一方で、オッズ比は層の併合可能性を持たないことが知られています。表1と表2において、オッズ比は0.29倍、0.38倍、0.17倍と変化していますよね。
:::

::: panel-tabset
### ステージによる層別前

表1. 仮想的ながんランダム化臨床試験におけるリスク差・リスク比・オッズ比

|               | 緩和療法群 | 抗がん剤投与群 | 効果の指標 |
|---------------|------------|----------------|------------|
| 合計（100人） |            |                |            |
| 　死亡        | 30         | 15             |            |
| 　生存        | 20         | 35             |            |
| 　死亡リスク  | 60%        | 30%            |            |
| 　リスク差    |            |                | -30%       |
| 　リスク比    |            |                | 0.50倍     |
| 　オッズ比    |            |                | 0.29倍     |

### ステージによる層別後

表2. 層別後の死亡リスクとリスク差・リスク比・オッズ比

|                     | 緩和療法群 | 抗がん剤投与群 | 効果の指標 |
|---------------------|------------|----------------|------------|
| ステージIII（50人） |            |                |            |
| 　死亡              | 10         | 5              |            |
| 　生存              | 15         | 20             |            |
| 　死亡リスク        | 40%        | 20%            |            |
| 　リスク差          |            |                | -20%       |
| 　リスク比          |            |                | 0.50倍     |
| 　オッズ比          |            |                | 0.38倍     |
| ステージIV（50人）  |            |                |            |
| 　死亡              | 20         | 10             |            |
| 　生存              | 5          | 15             |            |
| 　死亡リスク        | 80%        | 40%            |            |
| 　リスク差          |            |                | -40%       |
| 　リスク比          |            |                | 0.50倍     |
| 　オッズ比          |            |                | 0.17倍     |
:::

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「なるほどね、リスク比を計算すると同じ0.5なのに、オッズ比の値はばらばらなんだ。オッズ比は層別すると同じ効果としては扱いにくいから注意しなさいってことね」
:::

::: voice-father
お父さん「そうだね、研究者としては、ステージ別でも層別しなくても、リスクが半分になる治療なら、半分ってことが読み取れる値になってほしいよね。そういう感覚でしょ」
:::

::: voice-daughter
私「うん」
:::

::: voice-father
お父さん「そこまではいいんだ。でも誤解してほしくないのは、リスク比は併合可能で、オッズ比は併合可能ではない、だからオッズ比が悪いっていいたいわけじゃないよ。結果の読み取り方と相性があるってこと。オッズ比はオッズ比で、ロジスティック回帰と対応しているっていうのは別のメリットがある」
:::

::: voice-daughter
私「ふーん。お父さんって数学的性質を整理するときめっちゃ早口」
:::
:::::::::::::::::::::::::::::::::

### リスク差、リスク比、オッズ比、どれを使う？

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「ごめん、そもそも論なんだけど。どうせ割合同士を比べるんだから、わざわざ比をとらなくてもいいんじゃない？パーセントの差でよくない？+10%とか-10%とか。リスクの違いはこれでじゅうぶん伝わるでしょ」
:::

::: voice-father
お父さん「うん、リスク差はもっと使われていいと思う。でも、リスク差にも欠点がある。複数の研究を集めてメタアナリシスをするとき、それぞれの研究から得られたリスク差やリスク比をひとつの値に要約するでしょ」
:::

::: voice-daughter
私「ああ、みたことある」
:::

::: voice-father
お父さん「このとき問題になるのが、コントロール群（プラセボ群や緩和療法群）で観察されたリスクが、研究によって低かったり高かったりすることなんだ。同じ疾患や治療を扱っていても、予後のいい患者ばかり集めた研究もあれば、予後の悪い患者を対象にした研究もあるでしょ」
:::

::: voice-daughter
私「そりゃあるよね」
:::

::: voice-father
お父さん「リスク差、リスク比、オッズ比で、どれがコントロール群のリスクの影響を受けやすいかを、55件のメタアナリシスのデータを使って調べた研究がある（Furukawa, Guyatt, Griffith 2002）。その結果、以下のようなことがわかった」
:::
:::::::::::::::::::::::::::::::::

- リスク差は、研究ごとにリスクが変動すると、その影響にともなうばらつきが大きい
- リスク比やオッズ比は、研究間を通じて数値が安定していた

::::::::::::::::::::::::::::::::: dialogue
::: voice-father
お父さん「つまりね、指標によって解釈のしやすさや統計的な特徴が違うっていうこと。リスク差だけでも、リスク比やオッズ比のような比の指標だけでも、論文で示す情報としては不足があるっていうのが、おそらく結論」
:::

::: voice-daughter
私「じゃあどうしたらいいのよ」
:::

::: voice-father
お父さん「結局、臨床研究で観察された差って、リスク差やワクチン有効率のようなひとつの数字で要約できないんだと思う。結果を報告するときは、**絶対指標**（リスク差）と**相対指標**（リスク比やハザード比）の両方を示したり、Kaplan-Meier曲線やAalen-Johansen曲線をグラフにするのが正解なんじゃないかな。数字しか出せないなら、いちばんバランスがいいのは、リスク差+リスク比かもね」
:::
::::::::::::::::::::::::::::::::: 

::: {.callout-note appearance="simple" title="glm()を用いたリスク差、リスク比、オッズ比の計算"}

リスク差、リスク比、オッズ比はいろいろな手段で計算できますが、汎用性が高いのは一般化線型モデル（`glm`）を用いる方法です。リンク関数を選ぶことで、リスク差（`link="identity"`）、リスク比（`link="log"`）、オッズ比（`link="logit"`）を選択することができ、交絡因子の調整もしやすいのが便利なところです。ただし、リスク比とオッズ比では、回帰係数の指数をとるひと手間が必要です。表1のリスク差、リスク比、オッズ比を再現するコードを示しておきますので、参考まで。
:::

::: {.callout-note appearance="simple" collapse="true" title="Rコードと結果はこちら"}
```{r warning=FALSE}
dat <- data.frame(
  treat = factor(c("palliative", "palliative", "chemotherapy", "chemotherapy"), levels = c("palliative", "chemotherapy")),
  death = c(1, 0, 1, 0),
  n     = c(30, 20, 15, 35)
)
dat

fit_identity <- glm(
  death ~ treat,
  family  = binomial(link = "identity"),
  weights = n,
  data    = dat
)
risk_difference <- coef(fit_identity)[["treatchemotherapy"]]
print(risk_difference)

fit_log <- glm(
  death ~ treat,
  family  = binomial(link = "log"),
  weights = n,
  data    = dat
)
risk_ratio <- exp(coef(fit_log)[["treatchemotherapy"]])
print(risk_ratio)

fit_logit <- glm(
  death ~ treat,
  family  = binomial(link = "logit"),
  weights = n,
  data    = dat
)
odds_ratio <- exp(coef(fit_logit)[["treatchemotherapy"]])
print(odds_ratio)
```
:::

::: {.callout-note appearance="simple" title="このエピソードに関係するクイズです"}

一般化線型モデルの一種であるロジスティック回帰は、「確率」ではなく「オッズ」をモデル化しており、オッズ比を求めるためによく用いられます（田中2022）。さて、ロジスティック回帰を用いて、リスク比を計算することができるでしょうか。

1.  ロジスティック回帰を用いてリスク比を計算できる
2.  ロジスティック回帰を用いてリスク比を計算できない
:::

::: {.callout-note appearance="simple" collapse="true" title="答えはこちら"}
-   **正解は1です**

ロジスティック回帰の共変量に、数値を代入することで、確率を計算することができます。共変量として、2群（たとえば抗がん剤投与群と緩和療法群）を指定すれば、それぞれの群の確率が求まりますよね。その比をとれば、リスク比が計算できます。
:::

### 文献

- Furukawa TA, Guyatt GH, Griffith LE. Can we individualize the ‘number needed to treat’? An empirical study of summary effect measures in meta-analysis. Int J Epidemiol 2002; 31: 72-6

- [田中司朗. 医学研究のための因果推論I. 一般化線型モデル. 東京: 朝倉書店; 2022](https://www.asakura.co.jp/detail.php?book_code=12270)

### 次のエピソードとRスクリプト

- [From Risk to Logistic Regression](logistic-regression-2.html)
- [logistic-regression.R](../from-coffee-chat-to-r/logistic-regression.R)

::: {.callout-note appearance="simple" collapse="true" title="あのエピソードに飛べたい、そんな方はこちら"}

**このシリーズのエピソード**

- [Understanding Collapsibility of Effect Measures: Marginal vs Stratified](logistic-regression-1.html)
- [From Risk to Logistic Regression](logistic-regression-2.html)
- [Logit: How a Transformation Shapes an Effect](logistic-regression-3.html)
- [Where My Logistic Regression Went Wrong](logistic-regression-4.html)
- [Why Logistic Regression Fails in Small Samples](logistic-regression-5.html)
- [Understanding Confounding in Effect Measures: Marginal vs Stratified](logistic-regression-6.html)

**過去のシリーズ**

- [A Story of Coffee Chat and Research Hypothesis](study-design-1.html)
- [Reading a Paper over a Cup of Coffee](frequentist-1.html)
- [R Demonstration of Bias in Kaplan-Meier Under Competing Risks](frequentist-4.html)
- [Silent Confusions Hidden in Percentages](effects-1.html)

**用語集**

- [Statistical Terms in Plain Language](glossary.html)
:::