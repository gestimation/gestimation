---
format:
  html:
    toc: true
---
<style>
body {
  margin: 0;
  background: #ffffff;
  color: #2b1f1a;
  font-family: "Inter", "Helvetica Neue", Arial, sans-serif;
  font-size: 18px;
  line-height: 1.55;
}

h1, h2, h3 {
  font-family: "Georgia", "Times New Roman", serif;
  color: #3a2a22;
  font-weight: 600;
}

h3 {
  margin-top: 2.4rem;
}

a {
  color: #8b4a24;
  text-decoration: none;
}
a:hover {
  color: #6f3718;
  text-decoration: underline;
}

.navbar {
  background: #ffffff !important;
  border-bottom: 1px solid #e6e0da;
  margin-bottom: 0 !important;
}
.navbar .navbar-brand,
.navbar .navbar-nav > li > a {
  color: #3a2a22 !important;
  border-bottom: 2px solid transparent;
  padding-bottom: 2px;
}
.navbar .navbar-nav > li > a:hover {
  border-bottom-color: #8b4a24;
}

.hero-text {
  padding: 1.5rem 0;
  color: #3a2a22;
}

.project-card {
  border: 1px solid #e6e0da;
  padding: 1.3rem 1.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  background: #ffffff;
  border-radius: 6px;
  margin-bottom: 1.5rem;
}

.about-section {
  border: 1px solid #e6e0da;
  padding: 1.5rem;
  border-radius: 0;
  background: #ffffff;
  margin-top: 2.5rem;
}

.about-section::after {
  content: "";
  display: block;
  clear: both;
}

.author-photo {
  float: left;
  margin-right: 1rem;
  border-radius: 50%;
}

.btn-link {
  display: inline-block;
  border: 1px solid #8b4a24;
  color: #8b4a24;
  padding: 0.4rem 0.9rem;
  font-size: 0.9rem;
  border-radius: 3px;
}
.btn-link:hover {
  background: #8b4a24;
  color: #ffffff;
}

.content-narrow {
  max-width: 1000px;
  margin: 0 auto;
  padding: 1.8rem 1.2rem 2.5rem;
}

.hero-header {
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
}

.hero-header-img {
  width: 100vw;
  height: min(400px, 45vh);
  object-fit: cover;
  object-position: 50% 40%;
  display: block;
}

.dialogue p {
  line-height: 1.7;
}
.dialogue .voice-father p {
  color: #7a3e1a !important;
}
.dialogue .voice-daughter p {
  color: #234f7c !important;
}
.dialogue .voice-daughter,
.dialogue .voice-father {
  margin-bottom: 0.4rem;
}

.serif-text p {
  font-family: "Georgia", "Times New Roman", serif;
}
.serif-block p {
  font-family: "Georgia", "Times New Roman", serif;
  font-size: 0.9em;  line-height: 1.6;
}
</style>

::: hero-header
![](../image/father-daughter.png){.hero-header-img}
:::
# Story and Quiz − Adjusting for bias I

::: serif-block
　　　　　　　　　　　　Keywords: binary data, risk- and effect-measures, generalized linear model, confounding/information-bias/selection-bias, paper writing
:::

------------------------------------------------------------------------

### ロジスティック回帰をしてみたんだけど

::: {.callout-note appearance="simple" collapse="true" title="前回までのあらすじ"}
はじめて研究に取り組む娘と統計家の父。父に研究仮説は"PICO"を"PECO"で整理するといいとアドバイスされ、女医である娘は、がんサバイバーにおけるストーマ造設と復職状況の関係を調査することに決める。その後いくつか質問するうちに、父のことを「こいつ使える」と思い始めたのだった。
:::

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「これみてよ、お父さん」
:::

::: voice-father
お父さん「ん？どうしたの、この資料」
:::

::: voice-daughter
私「前に相談したがんサバイバーの復職状況を調べる研究についてなんだけどね、うちの診療科だけだけど調査票が集まったから、解析してみたの。その結果をまとめた資料よ」
:::

::: voice-father
お父さん「ああ、あれね。ストーマ造設と復職率の関連を調べることにしたんだっけ。資料のどこをみればいいの？」
:::

::: voice-daughter
私「この表なんだけど。ロジスティック回帰をしてみたんだ。その結果をまとめたよ。どうかな」
:::
:::::::::::::::::::::::::::::::::

| パラメータ | 自由度 | 推定値 | 標準誤差 | 95%信頼区間   | $\chi^2$ | p値    |
|------------|--------|--------|----------|---------------|-------|--------|
| Intercept  | 1      | -27.25 | 3.03     | -33.20～21.30 | 80.55 | \<0.01 |
| STOMA      | 1      | 1.41   | 1.54     | -16.1～4.45   | 0.84  | 0.3588 |
| AGE        | 1      | 1.47   | 1.48     | -1.42～4.36   | 0.99  | 0.3197 |
| SEX        | 1      | 25.72  | 0.00     | 25.72～25.72  |       |        |
| INCOME     | 1      | -0.00  | 0.00     | -0.00～0.00   | 0.58  | 0.4481 |

::::::::::::::::::::::::::::::::: dialogue
::: voice-father
お父さん「ふむふむ。よくある一般化線型モデルの結果だね。この表、上司にみせるんでしょ。その前にちょっと手直しした方がいいかもね」
:::

::: voice-daughter
私「やっぱり？そんな気がしてみてもらおうと思ったんだ」
:::

::: voice-father
お父さん「まず、Intercept、STOMA、AGE、SEX、INCOMEっていうのがわからないよ。Intercept以外は共変量（covariates）のことだよね」
:::

::: voice-daughter
私「共変量って？」
:::

::: voice-father
お父さん「共変量っていうのは、ロジスティック回帰に入れる説明変数のこと。復職率を規定する要因っていえばいいかな。それと、Interceptは回帰式でいう切片項のこと。統計ソフトウェアのアウトプットをそのまま表にしたんでしょ？きっとストーマ、年齢、性別、年収という変数を使ったんだと思うんだけど、データ上の変数名がそのままになっている。それに、出てきた数字をぜんぶ載せると、表がうるさくない？」
:::

::: voice-daughter
私「めっちゃしゃべるな。そうね、実はRの`glm()`を使ったんだけど、そこもよくわからなかったんだよね。そこから聞こうかな」
:::

::: voice-father
お父さん「どのあたり？」
:::

::: voice-daughter
私「`glm()`の指定の仕方。引数っていうの？」
:::
:::::::::::::::::::::::::::::::::

```{r eval=FALSE}
glm(y ~ x1 + x2, family = binomial(), data = dat)
```

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「以前、連続データは正規分布、2値データは2項分布ってイメージが大事みたいなこといってたでしょ？`glm()`もその延長だと思うんだけど、`family`とか`link`とか謎で、ロジスティック回帰になってるか自信ない」
:::

::: voice-father
お父さん「そこはね、単変量分布を**一般化線型モデル**に広げないと説明できないよ。つまりね、`glm()`はgeneralized linear modelの略なんだけど、ただの確率分布ってわけじゃなくて、3つのパーツから成り立っているんだ。ざっくりいうとこの3つだよ」
::: 

- 確率分布（データの型はなにか）

- 回帰係数×共変量

- リンク関数（平均をどう変換して線型にするか）

::: voice-daughter
私「で、それが`family`、`y ~ x1 + x2`、`link`なの？」
::: 

::: voice-father
お父さん「そう。`glm()`は、確率分布+回帰係数×共変量+リンクを指定してるだけなんだ」
::: 

::: voice-daughter
私「`y ~ x1 + x2`は私もわかるよ。調べたい変数をいれるんでしょ」
::: 

::: voice-father
お父さん「そうだね。Rの中では、この式がデザイン行列Xに変換されてる」
::: 
::::::::::::::::::::::::::::::::: 

```{r eval=FALSE}
X <- model.matrix(~ x1 + x2, data = dat)
```

::::::::::::::::::::::::::::::::: dialogue
::: voice-father
お父さん「ちょっとマニアックだけど、Rの内部では、`model.matrix()`っていう関数で、デザイン行列Xを作っている。Xの最初の列はすべて1になる。これは回帰直線でいう切片に対応している。次の列以降はx1とx2に対応する値が計算される。こうしておくと、たとえばx1が文字列でも数値に置き換えて計算できたり、回帰係数との掛け算が行列として計算できたり、なにかと都合がいい。ここまで覚えなくていいけど、仕組みを知っておくと理解が進むでしょ」
::: 

::: voice-daughter
私「なるほどね、じゃあ`family`ってなに？データの型？」
::: 

::: voice-father
お父さん「そう。`family`は日本語では分布族の意味だね。正確には**指数型分布族（exponential family）**。前にいったみたいに、データの型にあわせて確率分布を選ぶ」
::: 
::::::::::::::::::::::::::::::::: 

- 連続データ: gaussian()
- 2値データ: binomial()
- 計数データ: poisson()

```{r eval=FALSE}
glm(y ~ x1 + x2, family = gaussian(), data = dat)
glm(y ~ x1 + x2, family = binomial(), data = dat)
glm(y ~ x1 + x2, family = poisson(), data = dat)
```

::::::::::::::::::::::::::::::::: dialogue
::: voice-father
お父さん「ただしね、一般化線型モデルではデフォルト仕様みたいなものがあって、`family`を指定すると以下の3つが一度に決まるっていう特徴がある」
::: 

- yの確率分布
- yの分散
- その確率分布にあったリンク関数

::: voice-daughter
私「リンク関数ってなんだ？」
::: 

::: voice-father
お父さん「リンク関数（link function）は、**平均をどう変換して回帰係数×共変量にあわせるか**だよ。`family = binomial()`は、デフォルトでロジット関数というリンク関数を使っている。ロジット関数が、2項分布の構造にあった"自然な"リンク関数なんだ。これがロジスティック回帰だよ」
::: 

::: voice-daughter
私「そっか、よかった。うん、けっこうわかったから今日はもういい」
::: 
::::::::::::::::::::::::::::::::: 

::: {.callout-note title="このエピソードに関係するクイズです"}

ロジスティック回帰のリンク関数は、ロジット関数以外のものを代わりに使うことができます。リンク関数をうまく指定して確率πを変換することで、オッズ比以外の関連の指標を求められることが知られています。次の指標のうち、対応するリンク関数がなく、求められないものはどれでしょうか。

1.  リスク差
2.  リスク比
3.  ハザード比
4.  1、2、3すべて求めることができる
:::

::: {.callout-note collapse="true" title="答えはこちら"}
-   **正解は4です**

一般化線型モデルはロジスティック回帰を一般化したもので、「リンク関数」を変えることで、さまざまな指標を計算できます（田中2022）。詳しくはのちのエピソードで述べますが、リンク関数は、ロジスティック回帰でいえば、リスク$\pi$を関数$g(\pi)$を用いて変換しています。

リスク差を求めるには、$g(\pi)=\pi$つまり恒等関数を指定します。

リスク比を求めるには、$g(\pi)=\log(\pi)$ つまり対数関数を指定します。

ハザード比を求めるには、$g(\pi)=\log\{-\log⁡(1-\pi)\}$つまり補2重対数（complementary log-log）関数を指定します。
:::



### Continuation of their story

[Study design I](study-design-1.qmd)

[Study design II](study-design-2.qmd)

[Study design III](study-design-3.qmd)

[Study design IV](study-design-4.qmd)

[Study design V](study-design-5.qmd)

[Study design I](study-design-1.qmd)

[Study design II](study-design-2.qmd)

[Study design III](study-design-3.qmd)

[Study design IV](study-design-4.qmd)

[Study design V](study-design-5.qmd)

[Frequentist thinking I](frequentist-1.qmd)

[Frequentist thinking II](frequentist-2.qmd)

[Frequentist thinking III](frequentist-3.qmd)

[Frequentist thinking IV](frequentist-4.qmd)

[Frequentist thinking V](frequentist-5.qmd)

[Effects and time I](effects-1.qmd)

[Effects and time II](effects-2.qmd)

[Effects and time III](effects-3.qmd)

[Effects and time IV](effects-4.qmd)

[Effects and time V](effects-5.qmd)

[Adjusting for bias I](logistic-regression-1.qmd)

[Adjusting for bias II](logistic-regression-2.qmd)

[Adjusting for bias III](logistic-regression-3.qmd)

[Adjusting for bias IV](logistic-regression-4.qmd)

[Causal inference I](causal-inference-1.qmd)

[Causal inference II](causal-inference-2.qmd)

[Causal inference III](causal-inference-3.qmd)

[Causal inference IV](causal-inference-4.qmd)

[The Craft of research I](publish-a-paper-1.qmd)

[The Craft of research II](publish-a-paper-2.qmd)

[The Craft of research III](publish-a-paper-3.qmd)

[The Craft of research IV](publish-a-paper-4.qmd)
