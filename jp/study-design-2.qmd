# Story and Quiz − Study design II
::: {.serif-block}
　　　　　　　　　　　　　　　　　　　　Keywords: OS/PFS/DFS/response, continuous/binary/count/survival
:::

------------------------------------------------------------------------

### データには型がある

:::::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「お父さんが、さっき、どの関数を使うかもアウトカムによって違うんだよっていってたじゃない？あれ、いまいちピンとこないんだけど。データなんて、全部数字じゃないの？」
:::

::: voice-father
お父さん「数字には違いないんだけどね。統計解析では、データの型がとても大事なんだ。代表的なのは、連続データ、2値データ、計数データ、生存時間データの4つ」
:::

::: voice-daughter
私「連続データって、年齢とか血圧みたいな測るやつでしょ？2値データもわかるよ。私が比較したいストーマ保有ありとなしとか」
:::

::: voice-father
お父さん「ご名答。で、計数データは、交通事故の発生件数のような、数をカウントしたデータのこと。生存時間データは、たとえば寿命とかだね。死亡など特定のイベントが起こるまでの時間を扱うデータだよ。今回のがんサバイバー調査でいえば、手術から復職までの時間とか、再発までの時間とかね」
:::

::: voice-daughter
私「いわれてみれば、たしかに種類が違うね。でも、昔受けたRの授業では、言われた通りにコード打ってただけだったなあ。t.test()とかglm()とかsurvfit()とか、なんか呪文みたいなのを」
:::

::: voice-father
お父さん「そうだね。パソコンある？」
:::

::: voice-daughter
私「へ」
:::

::: voice-father
お父さん「パソコン。あるでしょ。RStudioインストールしよう」
:::

::: voice-daughter
私「はあ、まあ声を掛けたのはこっちだからいいけど」
:::

::: voice-father
お父さん「Rではね、連続データを解析するなら、mean()、t.test()、lm() なんかがよく使われる」
:::

::: voice-daughter
私「はあ」
:::

::: voice-father
お父さん「2値データを集計するときはtable()。p値を計算するときはchisq.test()、fisher.test()。複雑な解析はglm(family = binomial) みたいな回帰モデル。生存時間データだと、survfit()、coxph()、それからcifplot()みたいな関数が出てくる」
:::

::: voice-daughter
私「そんなにいっぱい覚えられるわけないでしょ。Rの授業でも思ってたけど、そんなのあたかも呪文なんだって」
:::

::: voice-father
お父さん「覚えなくていいよ」
:::

::: voice-daughter
私「え、いいの？」
:::

::: voice-father
お父さん「大事なのは、どの型のデータに、どんな関数をあてるのかをイメージできること。もっといえば、どんな確率分布を仮定しているかを、なんとなくでいいから思い浮かべてほしいんだ」
:::

::: voice-daughter
私「確率分布？」
:::

::: voice-father
お父さん「学部でやったでしょ。正規分布（normal distribution）は聞いたことある？」
:::

::: voice-daughter
私「それくらいはね」
:::

::: voice-father
お父さん「私たち統計家はね、統計解析の裏で、なんらかの確率分布を考えてる。連続データの正規分布とか、2値データの2項分布（binomial distribution）とか、計数データのPoisson分布とかね。生存時間データだと、標準的な分布ってわけじゃないんだけど、一番シンプルな分布は指数分布（exponential distribution）っていうんだ」
:::

::: voice-daughter
私「はあ。それとRが関係するわけ？」
:::

::: voice-father
お父さん「うん。たとえばさ、データを要約するための指標として、割合（proportion）と率（rate）ってのがある。日常生活でもよく使うでしょ？交通事故の発生率とか。でも、日常では、割合と率の違いを意識しないよね。でも、統計の世界では、割合は2項分布のパラメータ、率はPoisson分布のパラメータなんだ」
:::

::: voice-daughter
私「割合と率なんて同じ意味でしょ？」
:::

::: voice-father
お父さん「違う違う。割合ってパーセントで表すでしょ、女性割合が60%とか。でも、"東京都の1年あたりの交通事故の発生率"を例に考えてみてよ。パーセントにならなくない？交通事故が何回、起きたかを年で割ってるだけだから」
:::

::: voice-daughter
私「ふーん。続けたまえ」
:::

::: voice-father
お父さん「教科書どおりじゃなくていいんだ。"あ、これは正規分布っぽい連続データだから、このあたりの関数かな"とか、0/1のデータだから、このへんの関数かなって、感覚で結びつけられるといいよ。Rの関数もずっと覚えやすくなる」
:::

::: voice-daughter
私「なるほどね。データの型と分布をイメージできれば、丸暗記不要ってことね。そいつははかどるわ」
:::

::: voice-father
お父さん「そうそう。イメージがあれば、あとでマニュアルや本を見たときに、ああ、これのことかってつながるからね。じゃあ、Rでちょっとだけデモを見せてみようか。年齢（連続）、性別とストーマ（2値）、生存時間（生存時間データ）をシミュレーションして、簡単な解析をやってみるよ」
:::

::: voice-daughter
私「また呪文が出てくるんでしょ？」
:::

::: voice-father
お父さん「そうだね。とりあえずlibrary(ggplot2)、library(cifmodeling)って打って。ヒストグラムとKaplan-Meier曲線を教えるよ」
:::

::: voice-daughter
私「とりあえず思考停止で打つわ」
:::

::: voice-father
お父さん「教えてあげてるんだから思考停止しない。Rの機能を追加するとき、install.packages()とlibrary()を使う。ざっくりいうとね、それぞれ、"Rパッケージをパソコンにインストールする"コマンドと、"インストール済みのパッケージを使えるようにする"コマンドなんだ」
:::

::: voice-daughter
私「ふむふむ。じゃあ、install.packages("cifmodeling")の方は、一度やったら、それで終わり？」
:::

::: voice-father
お父さん「基本的にはそう。同じパソコンなら、インストールは原則1回でOK。たとえば、install.packages("ggplot2")は、CRANっていうパッケージの倉庫から、自分のパソコンにダウンロードする。library(ggplot2)は、ggplot2を取り出して、"これからグラフを描くからこの道具を使います"ってRに宣言する」
:::

::: voice-daughter
私「なるほど。やっとスッキリした。今まで毎回インストールしなきゃいけないのかなって思ってた」
:::

::: voice-father
お父さん「毎回インストールすると、"コーヒー淹れるたびに豆を買いに行く"ようなものだからね。豆はまとめて買っておいて、飲むときに挽けばいい。パッケージも同じだよ」
:::
::::::::::::::::::::::::::::::::::::

::: {.callout-note title="シミュレーションデータの生成"}
ここでは、Rを使って簡単なシミュレーションデータを作り、連続データ・2値データ・生存時間データそれぞれについて、代表的な解析のデモをします。題材は「ストーマ保有者と非保有者の2群比較」です。

-   年齢：正規分布（rnorm）から生成した連続データ

-   性別・ストーマ保有：2項分布（rbinom関数）から生成した2値データ

-   生存時間：指数分布（rexp関数）から生成した生存時間データ

```{r}
set.seed(46)

n <- 200

# ストーマ保有あり(1)/なし(0)

stoma <- rbinom(n, size = 1, prob = 0.4)

# 性別 0 = 女性, 1 = 男性

sex <- rbinom(n, size = 1, prob = 0.5)

# 年齢：正規分布から生成（ストーマあり群を少し高齢に）

age <- rnorm(n, mean = 65 + 3 * stoma, sd = 8)

# 生存時間：指数分布（ストーマあり群の予後の期待値10年、ストーマなし群の予後の期待値15年）

rate  <- ifelse(stoma == 1, 1 / 10, 1 / 15)
time  <- rexp(n, rate = rate)

# ランダムな打ち切り（0 = 打ち切り, 1 = イベント）

status <- rbinom(n, size = 1, prob = 0.9)

dat <- data.frame(
age   = age,
sex   = factor(sex, levels = c(0, 1), labels = c("WOMAN", "MAN")),
stoma = factor(stoma, levels = c(0, 1), labels = c("WITHOUT STOMA", "WITH STOMA")),
time  = time,
status = status
)

head(dat)
```
:::

::: {.callout-note title="連続データと2値データの要約"}

まず、`ggplot2`パッケージの`ggplot()`と、`table()`を使って、ストーマあり群とストーマなし群のデータを**ヒストグラム**と**分割表**で記述しています。シミュレーションの設定を踏まえると、ヒストグラムでは、ストーマありとなしの間で、年齢の分布がずれているはずです。

```{r}
library(ggplot2)

ggplot(dat, aes(x = age, fill = stoma)) +
geom_histogram(alpha = 0.5, position = "identity", bins = 20) +
labs(x = "AGE", y = "FREQUENCY", fill = "STOMA") +
theme_minimal()

table(STOMA = dat$stoma, SEX = dat$sex)
```
:::

::: {.callout-note title="生存曲線による生存時間データの要約"}

次の生存時間データでは、`cifmodeling`パッケージの`cifplot()`を使って、**Kaplan–Meier曲線**を描いてみます。ストーマあり群より、ストーマなし群の方が、生存曲線が高くなる（生存期間が長くなる）はずです。

```{r}
library(cifmodeling)

survival_curve <- cifcurve(Event(time, status) ~ stoma,data = dat, outcome.type = "survival")
cifplot(survival_curve)
```
:::

::: {.callout-note title="このエピソードに関係するクイズです"}
奏効率（response rate）とは、抗がん剤による治療を行った結果、何割の患者で腫瘍が縮小したか（完全奏効または部分奏効を達成したか）や血液から腫瘍細胞が消えたか（完全寛解）を表す指標です。この用語は広く用いられていますが、Japan Clinical Oncology Group（JCOG）では奏効割合（response proportion）という表現を好んでいます（Japan Clinical Oncology Group 2021）。

さて、次の指標のうち、率（rate）に該当するのはどれでしょうか。

1.  打率
2.  男女比率
3.  有病率
4.  死亡率
:::

::: {.callout-note collapse="true" title="答えはこちら"}
-   **正解は4です。**

割合、率、比の3つの違いについて説明しましょう。比とは、ある量を別の量で割ったもののことです。たとえば、BMIは体重を身長で割ったものですから比の一種で、単位はkg/m2です。割合は、一部の数を全体の数で割ったもの（言い換えると、分母が分子を含んでいるもの）です。割合は、もちろん2値データや分類データを要約するために用いられる指標ですよね。この指標は、言葉の定義からいって、比の一種です。しかし、割合は、①100%を超えない、②人数を人数で割っているためキャンセルして単位がない（無単位）という特徴があります。割合と区別してほしいのが率です。たとえば胃がんの発生率（incidence rate of gastric cancer）というと、一定時間に胃がんが発生するスピードで、人年法（胃がんの発生数/観察人年）で計算されます。人数を人数×年で割っているため、単位は1/年（より一般には1/時間）です。

「打率」は安打数÷打数であり、「割合」になります。

「男女比率」は男性の人数÷女性の人数であり、「比」になります。

「有病率」は疾患を有する人の人数÷全体の人数であり、「割合」になります。

「死亡率」は死亡件数÷観察人年であり、「率」になります。
:::

### Continuation of their story

[Study design I](study-design-1.qmd)

[Study design II](study-design-2.qmd)

[Study design III](study-design-3.qmd)

[Study design III](study-design-4.qmd)

[Study design IV](study-design-5.qmd)

[Clinical trial I](clinical-trial-1.qmd)

[Clinical trial II](clinical-trial-2.qmd)

[Clinical trial III](clinical-trial-3.qmd)

[Epidemiology I](epidemiology-1.qmd)

[Epidemiology II](epidemiology-2.qmd)

[Epidemiology III](epidemiology-3.qmd)

[Epidemiology IV](epidemiology-4.qmd)

[Regression I](logistic-regression-1.qmd)

[Regression II](logistic-regression-2.qmd)

[Regression III](logistic-regression-3.qmd)

[Regression IV](logistic-regression-4.qmd)

[Causal inference I](causal-inference-1.qmd)

[Causal inference II](causal-inference-2.qmd)

[Causal inference III](causal-inference-3.qmd)

[Causal inference IV](causal-inference-4.qmd)

[Publish a paper I](publish-a-paper-1.qmd)

[Publish a paper II](publish-a-paper-2.qmd)

[Publish a paper III](publish-a-paper-3.qmd)

[Publish a paper IV](publish-a-paper-4.qmd)
