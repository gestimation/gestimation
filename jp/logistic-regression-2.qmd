---
title: "Logit: How a Transformation Shapes an Effect"
format:
  html:
    toc: true
---

```{=html}
<style>
header#title-block-header.quarto-title-block {
  display: none !important;
}

body {
  margin: 0;
  background: #ffffff;
  color: #2b1f1a;
  font-family: "Inter", "Helvetica Neue", Arial, sans-serif;
  font-size: 18px;
  line-height: 1.55;
}

h1, h2, h3 {
  font-family: "Georgia", "Times New Roman", serif;
  color: #3a2a22;
  font-weight: 600;
}

h3 {
  margin-top: 2.4rem;
}

a {
  color: #8b4a24;
  text-decoration: none;
}
a:hover {
  color: #6f3718;
  text-decoration: underline;
}

.navbar {
  background: #ffffff !important;
  border-bottom: 1px solid #e6e0da;
  margin-bottom: 0 !important;
}
.navbar .navbar-brand,
.navbar .navbar-nav > li > a {
  color: #3a2a22 !important;
  border-bottom: 2px solid transparent;
  padding-bottom: 2px;
}
.navbar .navbar-nav > li > a:hover {
  border-bottom-color: #8b4a24;
}

.hero-text {
  padding: 1.5rem 0;
  color: #3a2a22;
}

.project-card {
  border: 1px solid #e6e0da;
  padding: 1.3rem 1.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  background: #ffffff;
  border-radius: 6px;
  margin-bottom: 1.5rem;
}

.about-section {
  border: 1px solid #e6e0da;
  padding: 1.5rem;
  border-radius: 0;
  background: #ffffff;
  margin-top: 2.5rem;
}

.about-section::after {
  content: "";
  display: block;
  clear: both;
}

.author-photo {
  float: left;
  margin-right: 1rem;
  border-radius: 50%;
}

.btn-link {
  display: inline-block;
  border: 1px solid #8b4a24;
  color: #8b4a24;
  padding: 0.4rem 0.9rem;
  font-size: 0.9rem;
  border-radius: 3px;
}
.btn-link:hover {
  background: #8b4a24;
  color: #ffffff;
}

.content-narrow {
  max-width: 1000px;
  margin: 0 auto;
  padding: 1.8rem 1.2rem 2.5rem;
}

.hero-header {
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
}

.hero-header-img {
  width: 100vw;
  height: min(400px, 45vh);
  object-fit: cover;
  object-position: 50% 40%;
  display: block;
}

.dialogue p {
  line-height: 1.7;
}
.dialogue .voice-father p {
  color: #7a3e1a !important;
}
.dialogue .voice-daughter p {
  color: #234f7c !important;
}
.dialogue .voice-daughter,
.dialogue .voice-father {
  margin-bottom: 0.4rem;
}

.text-right {
  text-align: right;
}
.serif-block p {
  font-family: "Georgia", "Times New Roman", serif;
  font-size: 0.9em;  line-height: 1.6;
}
</style>
```

::: hero-header
![](../image/father-daughter.png){.hero-header-img}
:::

# Adjusting for Bias II − Logit: How a Transformation Shapes an Effect

::: {.serif-block .text-right}
Keywords: binary outcome, effect measure, generalized linear model
:::

------------------------------------------------------------------------

### 数式を使ってロジスティック回帰を教えてよ

::::::::::::::::::::::::::::::::: dialogue
::: voice-father
お父さん「ああ、ここにいたんだ。コーヒーと大福？」
::: 

::: voice-daughter
私「うんうまいよ」
::: 

::: voice-father
お父さん「食べながらでいいから聞いてよ。ロジスティック回帰はね、医学研究でよく使うから知っておいた方がいいと思って。簡単にいうと、2値データのための回帰モデルの一種。ストーマ造設、年齢、性別、年収といった共変量が、復職の有無のような2通りの値をとるアウトカムとどの程度相関するかを、調べることができる」
::: 

::: voice-daughter
私「もうちょっと統計っぽく教えてよ」
::: 

::: voice-father
お父さん「ん？統計手法には、パラメトリック法とノンパラメトリック法があるけど、ロジスティック回帰はパラメトリックモデルの一種として位置づけられる。最近の教科書では、一般化線型モデルのひとつとして扱われることが多いかな」
::: 

::: voice-daughter
私「そういうんじゃなくてさ。ほら、リンク関数とか出てきたでしょ。ああいうのがでてくると消化不良でさ」
::: 

::: voice-father
お父さん「数式使っていいの？」
::: 

::: voice-daughter
私「うん。数式でてくると、ところどころわからないんだけど。ごまかされるのもいや。ほら、このペン使っていいよ」
::: 

::: voice-father
お父さん「じゃあ、個人のリスクと共変量の関係から話せばいいのかな」
::: 
::::::::::::::::::::::::::::::::: 


::: {.callout-note appearance="simple" title="個人のリスクと共変量"}

$N$人の対象者に番号をつけて$i=1,...,N$で表すことにします。個人$i$のリスクを$\pi_i$で表します。$\pi_i$は、個人レベルの$N$個のパラメータですが、そのすべてを別々に推定したいわけではありません。$\pi_i$に関連する$p-1$個の共変量$X_{i,1},X_{i,2},...,X_{i,p-1}$が測定されており、両者の関連の強さに関心があるとします。このとき

$\log(\frac{\pi_i}{1-\pi_i})=\beta_0+\beta_1X_{i,1}+...+\beta_{p-1}X_{i,p-1}$

という関係が成り立つ確率分布をロジスティック回帰といいます。

この式の係数$\beta_0,\beta_1,...,\beta_{p-1}$を回帰係数（regression coefficients）、特に$\beta_0$を切片項（intercept）といいます。正規分布は平均と分散というパラメータで形状が決まりますよね。それと同じように、ロジスティック回帰の確率分布は、回帰係数$\beta_0,\beta_1,...,\beta_{p-1}$で規定されます。$\pi_i$は、$\beta_0,\beta_1,...,\beta_{p-1}$が与えられれば計算できますが、直接推定するわけではありません。
:::

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「ふむふむ。ひとりひとりに$\pi_i$と$X_{i,1},X_{i,2},...,X_{i,p-1}$がある。そしてロジスティック回帰の式で結びついているわけね。そして、その式の係数が回帰係数」
::: 

::: voice-father
お父さん「そう。ロジスティック回帰の裏には2項分布があって、実は$\pi_i$は2項分布の確率に対応している。2項確率の式に、共変量$X_{i,1},X_{i,2},...,X_{i,p-1}$が含まれていて、アウトカムと共変量の関連の強さを、回帰係数が決めるんだ」
::: 

::: voice-daughter
私「この式まではわかったよ」
::: 

::: voice-father
お父さん「よかった。ちょっと補足するとね、確率分布に含まれる未知数のことを、統計学ではパラメータと呼んでいる。そしてパラメータの関数として、確率分布を書くことができるものを、パラメトリックモデルっていうんだ。こういう風に考えると、パラメータを推定したり、推定値に信頼区間をつけたりすることが、統計解析の目標になるよね。もうひとつ知っておいてほしいのが、アウトカムと共変量の関係は、ロジット関数で結びつくと仮定していること。`glm()`について話したの覚えてる？」
::: 

::: voice-daughter
私「うん。リンク関数を`link`で指定することは理解したよ。それがこの式？」
::: 

::: voice-father
お父さん「そうだよ。`glm()`の引数は、`family`、`y ~ x1 + x2`、`link`なんだけど`family=binomial()`のように
2項分布を選ぶと自動的にロジット関数が使われる。ロジスティック回帰の左辺をみてよ」
::: 

::::::::::::::::::::::::::::::::: 

::: {.callout-note appearance="simple" title="リンク関数とロジット関数"}

個人レベルのパラメータと共変量との関係を結びつける1対1の単調な変換

$g(\pi_i)=\beta_0+\beta_1X_{i,1}+...+\beta_{p-1}X_{i,p-1}$

のことを、一般にリンク関数（link function）といいます。ロジスティック回帰のリンク関数は、定義で述べた通り

$g(\pi_i)=\log(\frac{\pi_i}{1-\pi_i})$

です。この関数はロジット関数と呼ばれ、ロジスティック回帰を特徴付けています。
:::

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「単に関数に名前をつけただけでしょ。もうちょっと解説が欲しいなあ」
::: 

::: voice-father
お父さん「そうだよね。ロジット関数も関数の一種だから、グラフにした方が特徴がつかみやすい。次の説明だとどうかな」
::: 
::::::::::::::::::::::::::::::::: 

::: {.callout-note appearance="simple" title="ロジット関数の形状"}

仮に共変量が1個で、連続データだったとしましょう。確率$\pi_i$と共変量$X_i$の関係は、ロジット関数を通じて

$\log(\frac{\pi_i}{1-\pi_i})=\beta_0+\beta_1X_{i}$

という式で表されることになります。

図は、このロジット関数の$\exp(\beta_1)$の値を5、10、20、200と設定して、$X_i$を0から1までの範囲で変化させた、ロジット関数の逆関数のプロットです。$\exp(\beta_1)$は、$X_i$が1SD変化したときのオッズ比に相当します。つまり、図でもっとも傾きの小さい黒い曲線は、オッズ比5のときのものです。この曲線はそれほど変化が急にはみえませんが、医学研究ではオッズ比5でもかなり強い関連です。

このように、ロジット関数の逆関数はS字型の曲線を表しています。X軸方向にどんな値をとったとしても、Y軸方向の変化は0から1の範囲に収まることが、特徴のひとつです。そして、曲線の傾きは回帰係数$\beta_1$によって決まります。

![](logistic-regression-4.png)

:::

::::::::::::::::::::::::::::::::: dialogue
::: voice-daughter
私「やっとイメージがわいた。ロジット関数って、確率と共変量との関係を表してるんだ。どれくらい年齢が上がると、復職できる確率が下がるか、みたいなことね」
::: 

::: voice-father
お父さん「そういうこと。でもね、もっと大事なのは`family`、`y ~ x1 + x2`、`link`を選ぶことで、データの型にあった回帰モデルを指定できるってこと。yとxにそれぞれ連続変数を指定すると、散布図に回帰直線を掛くことができるし、計数データにPoisson回帰を当てはめたりもできる。一般化線型モデルは、生存時間データや経時データ以外ならほとんど対応できる汎用的な統計手法なんだ」
::: 
::::::::::::::::::::::::::::::::: 


::: {.callout-note appearance="simple" title="データの型と統計手法"}

アウトカムはデータの型によって4種類に分類されます。

- 連続データ （例：血圧やQOL）
- 分類データ （例：有害事象の有無）
- 計数データ （例：有害事象の発生件数）
- 生存時間データ （例：全生存期間）

さらに、分類データはいくつかの種類があり、カテゴリが2通りのものを2値データ、カテゴリに順序があるものを順序データと呼んでいます。生存時間データの一種には、競合リスクを考慮した競合リスクデータがあります。データの型によって、正規分布や2項分布など確率分布が異なりますよね。そのため、それぞれ異なる統計手法が用いられます。詳しくは表をみてください。

仮に、ストーマ造設あり・なしと復職状況の関係を調べたいとすると、2つの変数をモデルに当てはめることになるため、回帰モデルを用いて調べたいとします。このときアウトカムを復職の有無（2値データ）とするなら、ロジスティック回帰を選ぶべきです。もし復職までの期間（生存時間データ）とするなら、Cox回帰の方が適切です。

**個人内で反復測定があるか**

同一個人にくり返し臨床検査やアンケートを行うと、似たような検査結果になりますよね。たとえば、朝と晩に血圧を測ると、2つの測定値に相関が生じます。治療前と治療後に、QOL質問票に回答してもらう場合も、その測定値は独立ではありません。このように1人の患者に複数回の測定値があるデータを**反復測定データ**といいます。反復測定データでは、個人内の測定値は独立ではありません。したがって、独立性を仮定している統計手法（たとえば対応のないt検定や$\chi^2$検定）は不適切です。反復測定データの解析では、**変量効果モデル（random-effects model）**や**一般化推定方程式（generalized estimating equation）**と呼ばれるやや高度な手法が用いられます。この場合の変量効果は、「ひとりひとりの個人の効果」を表しています。これらの方法は、個人内でデータが独立ではないこと（データの相関）を考慮するものです。

**交絡の調整が必要かどうか**

**交絡因子（confounder）**とは、治療とアウトカムとの関係を歪める第三の因子のことです。仮に、ストーマ造設あり・なしと復職状況の関係に、年齢が強くかかわっているとしましょう。そして、ストーマ保有者と非保有者で、平均年齢が異なっているとします。このような場合、2群間の年齢の違いを無視するとバイアスが生じます。これを補正するために、ロジスティック回帰がよく用いられます。 ランダム化臨床試験では、比較する群間で実験条件が揃っているため、交絡の調整は不要です。一方、観察研究（コホート研究やケース・コントロール研究）では交絡の調整は必須です。今回題材にした復職率の調査も観察研究の一種ですから、統計解析ではロジスティック回帰やCox回帰が主に用いられるでしょう。最近では交絡を調整して、正しく因果関係を調べるために、因果推論の手法（プロペンシティスコアなど）を用いることが増えてきました（田中2022）。

| データの型 | 反復測定 | 交絡調整 | 統計手法 | 備考 |
|---------------|---------------|---------------|---------------|---------------|
| 連続データ | なし | なし | 対応のない*t*検定、Wilcoxon順位和検定 | 平均の比較 |
|  | 個人内で2回測定 | なし | 対応のある*t*検定、Wilcoxon符号付順位検定 | 対応のあるデータ |
|  | なし | なし | 正規線型モデル | 回帰モデルの一種 |
|  | あり | あり | 変量効果モデル、一般化推定方程式 | 回帰モデルの一種 |
| 2値データ | なし | なし | $\chi^2$検定 | 割合の比較 |
|  | 個人内で2回測定 | あり | McNemar検定 | 対応のあるデータ |
|  | なし | あり | ロジスティック回帰 | 回帰モデルの一種 |
|  | あり | あり | 変量効果モデル、一般化推定方程式 | 回帰モデルの一種 |
| 計数データ | なし | なし | $\chi^2$検定 | 発生率の比較 |
|  | なし | あり | Poisson回帰 | 回帰モデルの一種 |
|  | あり | あり | 変量効果モデル、一般化推定方程式 | 回帰モデルの一種 |
| 生存時間データ | なし | なし | Kaplan-Meier曲線 | 生存曲線の記述 |
|  | なし | あり | Cox回帰 | 回帰モデルの一種 |
| 競合リスクデータ | なし | なし | Aalen-Johansen曲線 | 累積発生率曲線の記述 |
|  | なし | あり | Fine-Grayモデル | 回帰モデルの一種 |
:::

::: {.callout-note appearance="simple"  title="このエピソードに関係するクイズです"}

脳卒中発症の有無をアウトカム、LDLコレステロールを共変量としてロジスティック回帰を当てはめたとします。LDLコレステロールの単位をmg/dLからmmol/Lに変換したとき、オッズ比は何倍になるでしょうか。ただし

LDLコレステロール(mmol/L) =LDL コレステロール(mg/dL) ×0.02586

という関係が成り立ちます。

1.  0.02586倍
2.  1/0.02586倍
3.  変化しない
4.  1、2、3すべて誤り
:::

::: {.callout-note appearance="simple"  collapse="true" title="答えはこちら"}
**正解は4です。**

これは単位を換算するにはどうすればよいかという問題です。ある共変量*X*の効果は、回帰係数*β*との積（*βX*）で表され、それは共変量の単位によらず一定ですよね。このことに気づくと、答えに近づきます。*X*の単位を定数倍すると、*β*は定数分の一に換算されます。ただし、ロジスティック回帰では、回帰係数からロジット関数を経由してオッズ比を求めるため、単位を換算するには、1/0.02586乗のようにべき乗の操作をすることになります。
:::

### エピソード、用語集、Rスクリプト

- [From Risk to Logistic Regression](logistic-regression-1.html)
- [Logit: How a Transformation Shapes an Effect](logistic-regression-2.html)
- [Where My Logistic Regression Went Wrong](logistic-regression-3.html)
- [Why Logistic Regression Fails in Small Samples](logistic-regression-4.html)
- [Simpson's paradox](logistic-regression-5.html)

- [Statistical Terms in Plain Language](glossary.html)

- [logistic-regression.R](../from-coffee-chat-to-r/logistic-regression.R)
