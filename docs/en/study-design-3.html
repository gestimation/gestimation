<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Every study starts with a question. How do we frame PICO/PECO? How do we choose outcomes? How do we protect against bias? The daughter learn what do researchers mean by outcome from her father.">

<title>Outcomes: The Bridge from Data Collection to Analysis – Coffee and Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FCK3LX51C6"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-FCK3LX51C6', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Coffee and Research</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://gestimation.github.io/cifmodeling/"> 
<span class="menu-text">cifmodeling</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-a-conversation-on-causality-at-our-table-(en" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">A Conversation on Causality at Our Table (EN)</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-a-conversation-on-causality-at-our-table-(en">    
        <li>
    <a class="dropdown-item" href="../en/index.html">
 <span class="dropdown-text">Index</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../en/study-design-1.html">
 <span class="dropdown-text">Study design</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-a-conversation-on-causality-at-our-table-(jp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">A Conversation on Causality at Our Table (JP)</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-a-conversation-on-causality-at-our-table-(jp">    
        <li>
    <a class="dropdown-item" href="../jp/index.html">
 <span class="dropdown-text">Index</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../jp/study-design-1.html">
 <span class="dropdown-text">Study design</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#study-design-iii-outcomes-the-bridge-from-data-collection-to-analysis" id="toc-study-design-iii-outcomes-the-bridge-from-data-collection-to-analysis" class="nav-link active" data-scroll-target="#study-design-iii-outcomes-the-bridge-from-data-collection-to-analysis">Study Design III − Outcomes: The Bridge from Data Collection to Analysis</a>
  <ul class="collapse">
  <li><a href="#what-do-we-mean-by-outcome" id="toc-what-do-we-mean-by-outcome" class="nav-link" data-scroll-target="#what-do-we-mean-by-outcome">What Do We Mean by “Outcome”?</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">Reference</a></li>
  <li><a href="#episodes-glossary-and-r-script" id="toc-episodes-glossary-and-r-script" class="nav-link" data-scroll-target="#episodes-glossary-and-r-script">Episodes, glossary, and R-script</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Outcomes: The Bridge from Data Collection to Analysis</h1>
</div>

<div>
  <div class="description">
    Every study starts with a question. How do we frame PICO/PECO? How do we choose outcomes? How do we protect against bias? The daughter learn what do researchers mean by outcome from her father.
  </div>
</div>


<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<div class="hero-header">
<p><img src="../image/father-daughter.png" class="hero-header-img img-fluid"></p>
</div>
<section id="study-design-iii-outcomes-the-bridge-from-data-collection-to-analysis" class="level1">
<h1>Study Design III − Outcomes: The Bridge from Data Collection to Analysis</h1>
<div class="serif-block text-right">
<p>Keywords: clinical trial, hypothesis/outcome/population, survival/competing-risk, language/writing</p>
</div>
<hr>
<section id="what-do-we-mean-by-outcome" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-mean-by-outcome">What Do We Mean by “Outcome”?</h3>
<div class="dialogue">
<div class="voice-daughter">
<p>Me: “About that outcome thing we talked about earlier. In our department we read clinical trial papers, and they’re full of abbreviations like DFS and RFS. Those are outcomes too, right? To be honest I don’t really understand them, but everyone uses them as if they were obvious, so it’s hard to ask now. DFS and RFS both seem to be about cancer recurrence. Do you know the difference?”</p>
</div>
<div class="voice-father">
<p>Dad: “Of course. We often deal with DFS in statistical analyses. The one you probably see most is <strong>overall survival (OS)</strong>. DFS stands for <strong>disease-free survival</strong>, and RFS stands for <strong>relapse-free survival</strong>.”</p>
</div>
<div class="voice-daughter">
<p>Me: “So relapse-free survival is just the number of days until recurrence?”</p>
</div>
<div class="voice-father">
<p>Dad: “If we were literally measuring ‘time to recurrence’, I’d probably call that relapse-free time. When we focus on recurrence, we often talk about the <strong>cumulative incidence of relapse</strong>, or CIR for short.”</p>
</div>
<div class="voice-daughter">
<p>Me: “That just made it worse. Aren’t all of these basically the same?”</p>
</div>
<div class="voice-father">
<p>Dad: “In survival analysis, the differences are subtle but important. Think about this: a patient can die without ever having a recurrence. For DFS, the key idea is that we measure the <strong>time from the time origin to the first of three events</strong>: recurrence, second primary cancer, or death. So not only recurrence, but also death and second cancers are treated as events.”</p>
</div>
<div class="voice-daughter">
<p>Me: “What exactly do you mean by ‘treated as events’?”</p>
</div>
<div class="voice-father">
<p>Dad: “In general, survival time data represent the time until a specified event. To put it simply: suppose you compute the ‘3-year DFS probability’ from DFS data. That corresponds to the probability that no event has occurred by 3 years. In other words, the probability that at 3 years the patient is alive, with no recurrence and no second cancer.”</p>
</div>
<div class="voice-daughter">
<p>Me: “Okay, that I can follow.”</p>
</div>
<div class="voice-father">
<p>Dad: “For RFS, the event is usually defined as recurrence or death. Second cancers are not included. If we were being strict about relapse-free time, then recurrence alone would be the event. Seeing it as a figure would probably make the picture clearer.”</p>
</div>
<div class="voice-daughter">
<p>Me: “Mm-hmm. Personally, I feel like DFS is the most important. You’d like to avoid both recurrence and second cancers. Relapse-free time doesn’t feel that meaningful to analyze. And death is the most important event, isn’t it? Why would you leave it out?”</p>
</div>
<div class="voice-father">
<p>Dad: “You’re right that death is critical. But remember, once a patient has a recurrence and then dies afterwards, they’re already counted as an event for relapse-free survival, even if the death is recorded later.”</p>
</div>
<div class="voice-daughter">
<p>Me: “That’s true. If I think about it, deaths that occur before recurrence are often due to things like infections or traffic accidents. Such causes may not be clearly related to the cancer treatment or the cancer itself.”</p>
</div>
<div class="voice-father">
<p>Dad: “Exactly. In clinical trials, outcomes are often called endpoints. Different trials have different research hypotheses, and endpoints are chosen accordingly. For advanced cancer, we might focus on tumor progression and use progression-free survival. For post-operative adjuvant chemotherapy after curative surgery, we might use relapse-free survival. Let me show you a table summarizing the main survival endpoints in oncology trials (Japan Clinical Oncology Group, 2021).”</p>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 46%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Endpoint</th>
<th>What counts as an event?</th>
<th>censoring date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Overall survival (OS)</td>
<td>Death from any cause</td>
<td>Last survival confirmation date</td>
</tr>
<tr class="even">
<td>Progression-free survival (PFS)</td>
<td>Progression or death</td>
<td>Last progression-free confirmation date</td>
</tr>
<tr class="odd">
<td>Relapse-free survival (RFS)</td>
<td>Relapse or death</td>
<td>Last survival confirmation date</td>
</tr>
<tr class="even">
<td>Relapse-free time</td>
<td>Relapse</td>
<td>Last survival confirmation date</td>
</tr>
<tr class="odd">
<td>Cumulative incidence of relapse (CIR)</td>
<td>Relapse only, with death as a competing risk</td>
<td>Last survival confirmation date</td>
</tr>
<tr class="even">
<td>Disease-free survival (DFS)</td>
<td>Relapse, second cancer, or death</td>
<td>Last survival confirmation date</td>
</tr>
<tr class="odd">
<td>Event-free survival (EFS)</td>
<td>Death, induction failure, relapse, second cancer (depends on trial)</td>
<td>Last survival confirmation date</td>
</tr>
<tr class="even">
<td>Treatment success time</td>
<td>Death, treatment failure, progression/relapse (depends on trial)</td>
<td>Last treatment-continuation/progression-free confirmation date</td>
</tr>
</tbody>
</table>
<div class="dialogue">
<div class="voice-daughter">
<p>Me: “Nice. This is really helpful.”</p>
</div>
<div class="voice-father">
<p>Dad: “This table is used when clinical trial groups write their protocols. Protocols are written by a team of clinicians and statisticians. If they don’t define things clearly in advance, everything gets confusing later on. Their motto is ‘one word, one meaning’.”</p>
</div>
<div class="voice-daughter">
<p>Me: “Yeah, I can relate. I’m already halfway tangled up.”</p>
</div>
<div class="voice-father">
<p>Dad: “For OS, the outcome is the time from the <strong>time origin</strong> of the analysis until death. For DFS, it’s the time from the time origin until whichever happens first: recurrence, second primary cancer, or death. As I mentioned, people also say ‘3-year OS’ or ‘3-year DFS’. In that case we’re not talking about a time, but about the probability at 3 years. Because DFS includes recurrence and second cancers in addition to death, the 3-year DFS probability is necessarily smaller than the 3-year OS probability.”</p>
</div>
<div class="voice-daughter">
<p>Me: “Time origin… I’ve never heard that expression before. Can you explain that a bit more?”</p>
</div>
<div class="voice-father">
<p>Dad: “Sure. Let’s go over a few typical ways of choosing the time origin. DFS is usually used to evaluate what happens after curative surgery, right? So the date of surgery is a natural candidate for the time origin. When the starting point of treatment is clear, like the day of surgery, the choice is relatively easy.”</p>
</div>
<div class="voice-daughter">
<p>Me: “Yeah, that’s what I see a lot in papers.”</p>
</div>
<div class="voice-father">
<p>Dad: “Exactly. On the other hand, if you used the date of discharge as the time origin, then deaths occurring shortly after surgery but before discharge would not be included in the evaluation. Depending on the study, that could easily become a point of criticism. Another common choice is the date of trial registration. In randomized controlled trials, treatment is assigned at registration, so it’s natural to use the registration date as the time origin when drawing survival curves.”</p>
</div>
<div class="voice-daughter">
<p>Me: “That makes sense. The exact definitions really do differ a bit from study to study. Actually, I’m in the middle of designing a questionnaire right now. When I told people that you’re ‘picky about outcomes’, it turned out everyone around me was paying more attention to these distinctions than I’d expected. I wanted to properly understand DFS and OS. I’m glad I asked ? I’ll come back for more advice.”</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled" title="Clinical endpoints and surrogate endpoints">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Clinical endpoints and surrogate endpoints
</div>
</div>
<div class="callout-body-container callout-body">
<p>OS, DFS, and RFS are outcomes or endpoints that are frequently used when evaluating the effectiveness of post-operative adjuvant chemotherapy. How are these endpoints chosen and used? One guiding principle comes from how regulatory agencies evaluate anticancer drugs. For example, the Japanese guideline on clinical evaluation of anticancer drugs states that, in order for an anticancer drug to be approved, its efficacy must be demonstrated reliably, typically through evidence such as prolongation of survival. In this framework, overall survival (OS) is treated as a clinical endpoint and given particular weight (Biomarkers Definitions Working Group, 2001).</p>
<p>At the same time, in adjuvant chemotherapy trials, endpoints such as DFS are sometimes adopted as surrogate endpoints. A surrogate endpoint is defined as a measure intended to substitute for a clinical endpoint and expected to predict clinical benefit or harm. The main advantage of using surrogate endpoints like DFS is that trials can be completed in a shorter period of time.</p>
<p>However, past regulatory experience has shown that reliance on surrogate endpoints can lead to misleading evaluations of drugs (Fleming and DeMets, 1996). For example, in advanced colorectal cancer, the combination of 5-FU and leucovorin produced promising tumor shrinkage in clinical trials. Yet when the clinical endpoint OS was evaluated, it became clear that the regimen had little or no effect on survival (Fleming and DeMets, 1996).</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled" title="A quiz related to this episode">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A quiz related to this episode
</div>
</div>
<div class="callout-body-container callout-body">
<p>This quiz focuses on how we define progression and events when using <strong>progression-free survival (PFS)</strong> as an endpoint in clinical trials. To measure PFS, we need to determine tumor progression based on imaging. Sometimes a central review committee evaluates images to make this more objective. In that case, there may be discrepancies between:</p>
<ul>
<li>the progression date according to the <strong>central review</strong>, and<br>
</li>
<li>the progression date according to the <strong>local investigator</strong>.</li>
</ul>
<p>This issue is called a disagreement between central and local assessment. Which of the following is not appropriate as a way to handle this in a clinical trial?</p>
<ol type="1">
<li>In the primary analysis, use the results of the central review, which is considered more objective.<br>
</li>
<li>In the primary analysis, define progression as whichever date comes first: central or local.<br>
</li>
<li>Hold a case review meeting and decide how to handle discrepant cases based on medical judgment.<br>
</li>
<li>Perform two analyses: one using central assessment, and one using local assessment.</li>
</ol>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled" title="Answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>The correct answer is <strong>2</strong>.</li>
</ul>
<p>If you define the event as “whichever progression date comes first (central or local)”, you are more likely to shorten PFS artificially, because you systematically choose the earlier of the two dates. That introduces bias.</p>
<p>This doesn’t mean you must always use central review; in some contexts, local assessment may better reflect real clinical decision-making. But “always take the earlier date” is not an appropriate general rule.</p>
</div>
</div>
</div>
</section>
<section id="reference" class="level3">
<h3 class="anchored" data-anchor-id="reference">Reference</h3>
<ul>
<li><p>Biomarkers Definitions Working Group. Biomarkers and surrogate endpoints: preferred definitions and conceptual framework. Clin Pharmacol Ther 2001;69(3):89-95</p></li>
<li><p>Fleming TR and DeMets DL. Surrogate end points in clinical trials: are we being misled? Ann Intern Med 1996;125(7):605-13</p></li>
<li><p><a href="https://jcog.jp/doctor/tool/manual/">JCOG protocol manual version 3.8 [Internet]. Tokyo: Japan Clinical Oncology Group; 2025</a></p></li>
</ul>
</section>
<section id="episodes-glossary-and-r-script" class="level3">
<h3 class="anchored" data-anchor-id="episodes-glossary-and-r-script">Episodes, glossary, and R-script</h3>
<ul>
<li><a href="study-design-1.html">A Story of Coffee Chat and Research Hypothesis</a></li>
<li><a href="study-design-2.html">Data Have Types: A Coffee-Chat Guide to R Functions for Common Outcomes</a></li>
<li><a href="study-design-3.html">Outcomes: The Bridge from Data Collection to Analysis</a></li>
<li>[A First Step into Survival and Competing Risks Analysis with R]</li>
<li>[When Bias Creeps In: Selection, Information, and Confounding in Clinical Surveys]</li>
<li><a href="glossary.html">Statistical Terms in Plain Language</a></li>
<li><a href="../from-coffee-chat-to-r/study-design.R">study-design.R</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/gestimation\.github\.io\/coffee-and-research");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>